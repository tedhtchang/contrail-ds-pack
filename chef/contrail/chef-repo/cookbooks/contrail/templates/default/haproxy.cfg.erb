################################################
#
#              Generated by Chef
#
################################################

global
        daemon
        user haproxy
        group haproxy
        pidfile /var/run/haproxy.pid
        log /dev/log    local0
        log /dev/log    local1 notice
        maxconn 8000

defaults
        log     global
        mode    http
        option  httplog
        option  dontlognull
        timeout connect 5000
        timeout client  50000
        timeout server  50000

#contrail-config-marker-start
listen contrail-config-stats :5937
   mode http
   stats enable
   stats uri /
   stats auth haproxy:contrail123

frontend  contrail-api *:8082
    default_backend    contrail-api-backend

frontend  contrail-discovery *:5998
    default_backend    contrail-discovery-backend

backend contrail-api-backend
    option nolinger
    balance     roundrobin
<% 
  idx = 9099
  @servers.each do |server|
    idx = idx + 1
-%>
    <%= "server #{server['contrail']['cfgm']['ip']} #{server['contrail']['cfgm']['ip']}:#{idx} check inter 2000 rise 2 fall 3" %>
<% end -%>
    #server  10.84.14.2 10.84.14.2:9100 check
    #server  10.84.14.2 10.84.14.2:9101 check

backend contrail-discovery-backend
    option nolinger
    balance     roundrobin
<% 
  idx = 9109
  @servers.each do |server|
    idx = idx + 1
-%>
    <%= "server #{server['contrail']['cfgm']['ip']} #{server['contrail']['cfgm']['ip']}:#{idx} check inter 2000 rise 2 fall 3" %>
<% end -%>

    #server  10.84.14.2 10.84.14.2:9110 check
    #server  10.84.14.2 10.84.14.2:9111 check

#contrail-config-marker-end
